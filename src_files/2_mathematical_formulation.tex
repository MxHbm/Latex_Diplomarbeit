\section{Mathematical formulation}
\label{sec:mathematical_formulation}

This two-index vehicle flow formulation for the \gls{VRP} is taken from \cite{tamke_branch-and-cut_2024}.\footcite[cf.][pp. 6-7]{tamke_branch-and-cut_2024}
The advantage is that infeasible tours of the subproblem \gls{CLP} are excluded
as route candidates for the masterproblem \gls{VRP} and no loading constraints are directly defined in the main model.

\subsection*{Sets}
A directed graph $G=(N,A)$ is defined with the set of nodes $N$ including
the depot and the set of customers $C$ excluding the depot. The arc set is
defines as $A = \{ (i, j) \mid i, j \in N \}$. The Sets $\delta^+$ and $\delta^-$ define
the arcs, which are leaving respective entering a node. For example, for node 3, $\delta^+ = \{(3,5)\}$ and $\delta^-= \{(2,3)\}$.
The set $A(S)$ defines a sequence of arcs connecting nodes in a random set of customers $C$,
which is a route in wider sense. For example the set $A(S)=\{(2,1),(1,5),(5,3)\}$ connects nodes
2 and 3 via node 5. Every set $A(S)$ is defined by the total volume $q(S)$ and total weight $v(S)$
demanded by all customers $i \in S$, with $S \subseteq C$. Set $A(P)$ includes all infeasible sequences $P$ leading
to an infeasible route.

\begin{table}[ht]
    \centering
    \begin{tabular}{llc}
        \toprule
        Symbol        & Description                              & Range                         \\
        \midrule
        $N$           & Set of nodes                             & $\{ 0, \dots, N \}$           \\
        $C$           & Set of customers                         & $\{ 1, \dots, N \} $          \\
        $A$           & Set of directed arcs                     & $\{(0,1), \dots, (n-1, n) \}$ \\
        $\delta^+(i)$ & Set of arcs leaving node $i$             & $\in A$                       \\
        $\delta^-(i)$ & Set of arcs entering node $i$            & $\in A$                       \\
        $A(S)$        & Set of arcs with both ends in subset $S$ & $\in A$                       \\
        $A(P)$        & Set of arcs in an infeasible path $P$    & $\in A$                       \\
        \bottomrule
    \end{tabular}
\end{table}
\vspace{0.2em}

\subsection*{Parameters}
The parameters are divided in the two groups static and set-dependent

the costs $c_{ij}$ for travelling from one node $i$ to another node $j$, and
are symmetrical defined, stating $c_{ij} \overset{!}{=} c_{ji}$. Additionally the number of vehicles
available for the fleet planning is given as constant $K$. No solution is allowed to have
more routes than avalaible vehicles. $r(S)$ defines a \gls{LB} for the numbers of vehicles needed
to include all customers in $S$. The \gls{LB} is calculated as the ceiling of the larger
value between the total weight $q(S)$ divided by the weight capacity $Q$, and the
total volume $v(S)$ divided by the volume capacity $V$:
\[r(S) = \max\left( \left\lceil \frac{q(S)}{Q} \right\rceil, \left\lceil \frac{v(S)}{V} \right\rceil \right)\]

\begin{table}[ht]
    \centering
    \begin{tabular}{ll}
        \toprule
        Symbol   & Description                                                   \\
        \midrule
        $c_{ij}$ & Cost or distance of traveling from node $i$ to node $j$       \\
        $K$      & Number of available vehicles                                  \\
        $Q$      & Weight limit of vehicle                                       \\
        $V$      & Volume limit of vehicle                                       \\
        $q(S)$   & Total weight requested by customers in $S$                    \\
        $v(S)$   & Total volume requested by customers in $S$                    \\
        $r(S)$   & Minimum number of vehicles required to cover customers in $S$ \\
        \bottomrule
    \end{tabular}
\end{table}

\bigskip

\subsection*{Decision Variable}
For the Two-Index-Flow model only one binary decision variable is necessary, which states, if the arc
between nodes $i$ and $j$ is included in the solution.
\[
    x_{ij} =
    \begin{cases}
        1 & \text{if arc } (i,j) \text{ is used in the solution} \\
        0 & \text{otherwise}
    \end{cases}
\]

\bigskip

\subsection*{Model}
\textbf{Objective:}
\begin{equation}
    \label{eq:objective}
    \min \sum_{(i,j)\in A} c_{ij}x_{ij}
\end{equation}

\textbf{Subject to:}
\begin{align}
    \sum_{(i,j)\in \delta^+(i)} x_{ij} & = 1                                                                                  &  & \forall i \in C                         \label{eq:flowout}     \\
    \sum_{(i,j)\in \delta^-(i)} x_{ij} & = 1                                                                                  &  & \forall i \in C                         \label{eq:flowin}      \\
    \sum_{(i,j)\in \delta^+(0)} x_{ij} & \leq K                                                       \label{eq:vehiclelimit}                                                                     \\
    \sum_{(i,j)\in A(S)} x_{ij}        & \leq |S| - r(S)                                                                      &  & \forall S \subseteq C, S \neq \emptyset \label{eq:capacitycut} \\
    \sum_{(i,j)\in A(P)} x_{ij}        & \leq |A(P)| - 1                                                                      &  & \forall \text{ infeasible paths } P     \label{eq:pathelim}
\end{align}

The objective function minimizes the total costs and the travelled distance incorporated
by each arc distance between nodes (\ref{eq:objective}). The constraints \ref{eq:flowin}
and \ref{eq:flowout} are restricting that every customer can only be visited once by defining the number
of arcs leaving and entering a node $i$ to 1. These two constraints do not apply to the depot,
which is included in every tour. Constraint~\ref{eq:vehiclelimit} limits the maximum number of
tours/ vehicles to $K$ by limiting the number of arcs entering the depot ($(i,j)\in \delta^+(0)$).
The next constraint~\ref{eq:capacitycut} states, that the number of arcs within the subset $A(S)$
must be smaller or equal to the number of customers minus the \gls{LB} for vehicles. This constraint
ensures, that routes are connected to the depot and that each subset $S$ is not violating
the volume and weight capacities. For example, if $S=\{1,2,3\}$ with $A(S)=\{(2,3),(3,1)\}$
and $r(S) = 1$, then $2 \leq 3 - 1$ holds, but if the \gls{LB} would be instead 2 then, $2 \not\leq 3 - 1$
and two tours need to be constructed. The last constraint~\ref{eq:pathelim} excludes all infeasible paths
$P$ from the solution, every path is defined by a subset of arcs $A(P)$ defining it. Infeasible
paths are labeled as such, when the corresponding \gls{CLP} to a route is not sufficient with loading
constraints. The constraint determines, that at least one binary variable defining an arc
from the set of arcs defining the infeasible path $|A(P)|$ has to have the value 0, that the left
side of this constraint is smaller equal to the right side. The set of infeasible paths is determined by
solving the subproblem of the \gls{CLP}.




